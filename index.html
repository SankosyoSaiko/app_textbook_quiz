<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‚è€ƒæ›¸ãƒã‚¤ã‚¹ã‚¿ãƒ¼ã®æŒ‘æˆ¦çŠ¶ Ver.9 (é¸ã¹ã‚‹é›£æ˜“åº¦)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@500;700&display=swap');
        body {
            font-family: 'Zen Maru Gothic', sans-serif;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .flip-card {
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .speech-bubble {
            position: relative;
            background: #ffffff;
            border-radius: .4em;
        }
        .speech-bubble:after {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            width: 0;
            height: 0;
            border: 10px solid transparent;
            border-right-color: #ffffff;
            border-left: 0;
            border-top: 0;
            margin-top: -5px;
            margin-left: -10px;
        }
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }
    </style>
</head>
<body class="bg-indigo-50 text-gray-800 min-h-screen flex items-center justify-center p-4">

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ -->
    <div class="max-w-md w-full bg-white rounded-2xl shadow-2xl overflow-hidden border border-indigo-100 relative">
        
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¨ãƒªã‚¢ -->
        <div class="bg-gradient-to-r from-indigo-600 to-purple-600 p-6 text-center text-white relative z-10">
            <div class="absolute -bottom-8 left-1/2 transform -translate-x-1/2">
                <div class="w-20 h-20 bg-white rounded-full border-4 border-indigo-500 flex items-center justify-center text-4xl shadow-lg relative">
                    ğŸ§â€â™‚ï¸
                    <span class="absolute -right-1 -top-1 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-full border border-white">Ver.9</span>
                </div>
            </div>
            <h1 class="text-xl font-bold mb-4">å‚è€ƒæ›¸ã®ç²¾éœŠ<br><span class="text-sm opacity-80">ã€œç„¡é™ã®æ›¸æ¶ã€œ</span></h1>
            
            <!-- ç®¡ç†ç”»é¢ãƒœã‚¿ãƒ³ -->
            <button onclick="goToLogin()" class="absolute top-4 right-4 text-white hover:text-yellow-200 transition opacity-80 hover:opacity-100">
                <span class="text-xs flex flex-col items-center">
                    ğŸ”’ <span class="scale-75">ç®¡ç†</span>
                </span>
            </button>
        </div>

        <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ -->
        <div class="pt-12 pb-6 px-6">
            
            <!-- ç²¾éœŠã®ã‚»ãƒªãƒ•ã‚¨ãƒªã‚¢ -->
            <div class="flex items-center mb-6 fade-in min-h-[80px]">
                <div class="speech-bubble bg-indigo-50 p-4 rounded-xl w-full text-center shadow-sm border border-indigo-100">
                    <p id="spirit-message" class="text-indigo-900 font-bold">ã•ã‚ã€ç§ã®çŸ¥è­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«æŒ‘ã‚€ãŒè‰¯ã„ã€‚</p>
                </div>
            </div>

            <!-- 1. ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ -->
            <div id="start-screen" class="text-center space-y-6">
                <p class="text-sm text-gray-500">ãƒ¢ãƒ¼ãƒ‰ã‚’é¸ã‚“ã§æŒ‘æˆ¦ã›ã‚ˆã€‚</p>
                
                <div class="grid grid-cols-1 gap-4">
                    <button onclick="startGame('normal')" class="bg-gradient-to-r from-blue-400 to-blue-500 hover:from-blue-500 hover:to-blue-600 text-white font-bold py-4 px-6 rounded-xl shadow-lg transition transform hover:scale-105 text-left flex justify-between items-center group">
                        <div>
                            <span class="block text-lg">ãƒãƒ¼ãƒãƒ«ãƒ¢ãƒ¼ãƒ‰</span>
                            <span class="text-xs opacity-80 font-normal">é †ã«ãƒ’ãƒ³ãƒˆå…¬é–‹ / -10ç‚¹</span>
                        </div>
                        <span class="text-2xl group-hover:translate-x-1 transition">ğŸ“–</span>
                    </button>

                    <button onclick="startGame('hard')" class="bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-bold py-4 px-6 rounded-xl shadow-lg transition transform hover:scale-105 text-left flex justify-between items-center group">
                        <div>
                            <span class="block text-lg">ãƒãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ‰</span>
                            <span class="text-xs opacity-80 font-normal">ãƒ’ãƒ³ãƒˆé¸æŠåˆ¶ / -15ç‚¹ / é‹ã¨ç›´æ„Ÿ</span>
                        </div>
                        <span class="text-2xl group-hover:translate-x-1 transition">ğŸ²</span>
                    </button>
                </div>
                
                <div class="text-xs text-gray-400 mt-4">
                    â€»ç®¡ç†ç”»é¢ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã®ç·¨é›†ãŒå¯èƒ½ã§ã™
                </div>
            </div>

            <!-- 2. ã‚¯ã‚¤ã‚ºç”»é¢ -->
            <div id="game-screen" class="hidden space-y-4">
                <div class="flex justify-between items-center text-sm font-bold text-gray-500 bg-gray-100 px-4 py-2 rounded-lg">
                    <span id="mode-badge" class="bg-blue-100 text-blue-600 px-2 py-0.5 rounded text-xs">NORMAL</span>
                    <div>SCORE <span id="current-score" class="text-orange-500 text-2xl font-mono ml-1">100</span></div>
                </div>

                <!-- ãƒ’ãƒ³ãƒˆè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
                <div id="hints-container" class="space-y-3 max-h-64 overflow-y-auto p-2 bg-gray-50 rounded-lg border border-gray-100 min-h-[150px]"></div>

                <!-- æ“ä½œã‚¨ãƒªã‚¢ -->
                <div class="pt-4 border-t border-gray-100">
                    
                    <!-- ãƒãƒ¼ãƒãƒ«ãƒ¢ãƒ¼ãƒ‰ç”¨ãƒœã‚¿ãƒ³ -->
                    <button id="next-hint-btn" onclick="showNextHint()" class="hidden w-full mb-4 bg-indigo-100 hover:bg-indigo-200 text-indigo-700 font-bold py-2 rounded-lg transition text-sm flex justify-center items-center gap-2">
                        <span>ğŸ’¡ æ¬¡ã®ãƒ’ãƒ³ãƒˆã‚’è¦‹ã‚‹</span>
                        <span class="bg-white px-2 py-0.5 rounded text-xs text-indigo-500">-10ç‚¹</span>
                    </button>

                    <!-- ãƒãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ‰ç”¨ãƒ‘ãƒãƒ« -->
                    <div id="select-hint-panel" class="hidden mb-4">
                        <p class="text-xs text-center text-gray-400 mb-2">è¦‹ãŸã„ãƒ’ãƒ³ãƒˆã‚«ãƒ¼ãƒ‰ã‚’é¸æŠï¼ˆ-15ç‚¹ï¼‰</p>
                        <div id="hint-buttons-grid" class="grid grid-cols-5 gap-2">
                            <!-- JSã§ç”Ÿæˆ -->
                        </div>
                    </div>

                    <div class="relative group mt-2">
                        <label class="text-xs text-gray-400 ml-1 mb-1 block">å›ç­”ã‚’å…¥åŠ›ï¼ˆãƒªã‚¹ãƒˆã‹ã‚‰é¸æŠï¼‰</label>
                        <input list="books-list" id="answer-input" class="w-full border-2 border-gray-300 rounded-lg p-3 focus:outline-none focus:border-indigo-500 transition text-lg" placeholder="å‚è€ƒæ›¸åã‚’å…¥åŠ›..." autocomplete="off">
                        <datalist id="books-list"></datalist>
                    </div>
                    
                    <button onclick="checkAnswer()" class="w-full mt-3 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-bold py-3 rounded-lg shadow-md transition transform active:scale-95">
                        å›ç­”ã™ã‚‹
                    </button>
                    
                    <button onclick="giveUp()" class="w-full mt-2 text-xs text-gray-400 hover:text-gray-600 underline">
                        é™å‚ã—ã¦ç­”ãˆã‚’è¦‹ã‚‹
                    </button>
                </div>
            </div>

            <!-- 3. çµæœç”»é¢ -->
            <div id="result-screen" class="hidden text-center space-y-6 fade-in">
                <div id="result-icon" class="text-7xl mb-2 animate-bounce">ğŸ‰</div>
                <h2 id="result-title" class="text-2xl font-bold text-gray-800">æ­£è§£ï¼</h2>
                
                <div class="bg-indigo-50 p-5 rounded-xl border border-indigo-100">
                    <p class="text-xs text-gray-500 uppercase tracking-widest mb-1">Answer</p>
                    <p id="result-book-name" class="text-xl font-bold text-indigo-900 mb-4 leading-relaxed">æ›¸ç±å</p>
                    
                    <div class="grid grid-cols-2 gap-4 border-t border-indigo-200 pt-4">
                        <div>
                            <p class="text-xs text-gray-500">ç²å¾—ã‚¹ã‚³ã‚¢</p>
                            <p id="final-score" class="text-3xl font-bold text-orange-500 font-mono">100</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500">ãƒ©ãƒ³ã‚¯</p>
                            <p id="result-rank" class="text-xl font-bold text-indigo-600">S</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-3 rounded border border-gray-200 text-left text-sm text-gray-600">
                    <p class="font-bold text-xs text-gray-400 mb-1">ã“ã®æœ¬ã®è±†çŸ¥è­˜</p>
                    <p id="result-comment">è§£èª¬ã‚³ãƒ¡ãƒ³ãƒˆãŒã“ã“ã«å…¥ã‚Šã¾ã™ã€‚</p>
                </div>

                <!-- SNSã‚·ã‚§ã‚¢ãƒœã‚¿ãƒ³ -->
                <div class="flex gap-2 justify-center pt-2">
                    <button onclick="shareOnTwitter()" class="flex-1 bg-black hover:bg-gray-800 text-white font-bold py-2 px-4 rounded-lg shadow transition flex items-center justify-center gap-2">
                        <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path></svg>
                        <span class="text-sm">Post</span>
                    </button>
                    <button onclick="shareOnLine()" class="flex-1 bg-[#06C755] hover:bg-[#05b34c] text-white font-bold py-2 px-4 rounded-lg shadow transition flex items-center justify-center gap-2">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.5c-5.52 0-10 3.98-10 8.95 0 2.66 1.34 5.06 3.52 6.74.37.28.6.68.52 1.15-.1.57-.47 1.87-.55 2.18-.08.3-.01.59.25.75.25.17.65.1.98-.05.78-.34 4.18-1.87 4.54-2.03.26-.11.53-.17.81-.17.31.01.62.03.93.03 5.52 0 10-3.98 10-8.95S17.52 2.5 12 2.5z"/></svg>
                        <span class="text-sm">LINE</span>
                    </button>
                </div>

                <button onclick="resetGame()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-full shadow-lg transition mt-2">
                    ãƒˆãƒƒãƒ—ã«æˆ»ã‚‹
                </button>
            </div>

            <!-- 4. ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ -->
            <div id="login-screen" class="hidden space-y-6 text-center fade-in">
                <div class="py-4">
                    <span class="text-5xl">ğŸ”’</span>
                </div>
                <h2 class="text-lg font-bold text-gray-800">ç®¡ç†è€…èªè¨¼</h2>
                <p class="text-sm text-gray-500">ã“ã‚Œã‚ˆã‚Šå…ˆã¯ç¦æ›¸åº«ï¼ˆç®¡ç†ç”»é¢ï¼‰ã§ã™ã€‚<br>åˆè¨€è‘‰ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>
                
                <div class="bg-gray-50 p-6 rounded-lg border border-gray-200 space-y-4">
                    <input id="admin-password" type="password" class="w-full p-3 border rounded-lg text-center text-lg focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-200 transition" placeholder="Password">
                    <p class="text-xs text-gray-400">â€»ãƒ‡ãƒ¢ç”¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: <span class="font-mono bg-gray-200 px-1 rounded">admin</span></p>
                    
                    <button onclick="attemptLogin()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-lg shadow transition">
                        èªè¨¼ã™ã‚‹
                    </button>
                </div>

                <button onclick="backToStart()" class="text-sm text-gray-400 hover:text-gray-600 underline">
                    æˆ»ã‚‹
                </button>
            </div>

            <!-- 5. ç®¡ç†ç”»é¢ -->
            <div id="admin-screen" class="hidden space-y-4 fade-in text-left flex flex-col h-[85vh]">
                <div class="flex justify-between items-center border-b pb-2 mb-2 flex-shrink-0">
                    <h2 class="text-lg font-bold text-gray-800">ğŸ“š ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã‚»ãƒ³ã‚¿ãƒ¼</h2>
                    <button onclick="logoutAdmin()" class="text-xs text-red-500 hover:text-red-700 font-bold border border-red-200 px-2 py-1 rounded bg-red-50">
                        ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
                    </button>
                </div>
                
                <!-- ãƒ•ã‚©ãƒ¼ãƒ ã‚¨ãƒªã‚¢ -->
                <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 space-y-3 flex-1 overflow-y-auto">
                    <div class="flex justify-between items-center">
                        <h3 id="form-title" class="font-bold text-sm text-indigo-600">æ–°è¦å‚è€ƒæ›¸ã‚’è¿½åŠ </h3>
                        <button id="cancel-edit-btn" onclick="cancelEdit()" class="hidden text-xs text-gray-500 underline">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    </div>
                    
                    <div>
                        <label class="text-xs font-bold text-gray-500">æ›¸ç±å (æ­£è§£) *å¿…é ˆ</label>
                        <input id="new-title" type="text" class="w-full p-2 border rounded text-sm" placeholder="ä¾‹ï¼šè‹±å˜èªStock3000">
                    </div>

                    <div>
                        <label class="text-xs font-bold text-gray-500">è±†çŸ¥è­˜ãƒ»ã‚³ãƒ¡ãƒ³ãƒˆ</label>
                        <input id="new-comment" type="text" class="w-full p-2 border rounded text-sm" placeholder="ä¾‹ï¼šã‚¹ã‚¿ãƒ‡ã‚£ã‚µãƒ—ãƒªé–¢å…ˆç”Ÿã®è‘—æ›¸ã€‚">
                    </div>

                    <div class="space-y-2">
                        <label class="text-xs font-bold text-gray-500">ãƒ’ãƒ³ãƒˆ (æœ€å¤§10å€‹)</label>
                        <input id="new-hint-1" type="text" class="w-full p-2 border rounded text-xs" placeholder="ãƒ’ãƒ³ãƒˆ1 *å¿…é ˆ">
                        <input id="new-hint-2" type="text" class="w-full p-2 border rounded text-xs" placeholder="ãƒ’ãƒ³ãƒˆ2">
                        <input id="new-hint-3" type="text" class="w-full p-2 border rounded text-xs" placeholder="ãƒ’ãƒ³ãƒˆ3">
                        <input id="new-hint-4" type="text" class="w-full p-2 border rounded text-xs" placeholder="ãƒ’ãƒ³ãƒˆ4">
                        <input id="new-hint-5" type="text" class="w-full p-2 border rounded text-xs" placeholder="ãƒ’ãƒ³ãƒˆ5">
                        <input id="new-hint-6" type="text" class="w-full p-2 border rounded text-xs" placeholder="ãƒ’ãƒ³ãƒˆ6">
                        <input id="new-hint-7" type="text" class="w-full p-2 border rounded text-xs" placeholder="ãƒ’ãƒ³ãƒˆ7">
                        <input id="new-hint-8" type="text" class="w-full p-2 border rounded text-xs" placeholder="ãƒ’ãƒ³ãƒˆ8">
                        <input id="new-hint-9" type="text" class="w-full p-2 border rounded text-xs" placeholder="ãƒ’ãƒ³ãƒˆ9">
                        <input id="new-hint-10" type="text" class="w-full p-2 border rounded text-xs" placeholder="ãƒ’ãƒ³ãƒˆ10 (æ±ºå®šçš„ãªãƒ’ãƒ³ãƒˆ) *æ¨å¥¨">
                    </div>

                    <button id="save-btn" onclick="handleSaveBook()" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-2 rounded shadow text-sm">
                        ãƒªã‚¹ãƒˆã«è¿½åŠ ã—ã¦ä¿å­˜
                    </button>
                    
                    <div class="mt-6 pt-4 border-t border-gray-200">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="font-bold text-sm text-gray-600">å…¨ç™»éŒ²ãƒªã‚¹ãƒˆï¼ˆä¸€æ‹¬ç®¡ç†ï¼‰</h3>
                            <span id="custom-count" class="text-xs bg-gray-200 px-2 py-0.5 rounded-full font-bold text-gray-700">0</span>
                        </div>
                        <div id="books-list-container" class="space-y-2"></div>
                    </div>
                </div>

                <div class="space-y-2 pt-2 flex-shrink-0">
                    <button onclick="exportData()" class="w-full bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 rounded text-xs">
                        å…¨ãƒ‡ãƒ¼ã‚¿ã‚’JSONã§ã‚³ãƒ”ãƒ¼ (ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç”¨)
                    </button>
                    <button onclick="resetToDefault()" class="w-full text-red-400 hover:text-red-600 text-xs underline py-1">
                        åˆæœŸãƒ‡ãƒ¼ã‚¿ã«æˆ»ã™ï¼ˆå…¨ãƒªã‚»ãƒƒãƒˆï¼‰
                    </button>
                    <button onclick="backToStart()" class="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 rounded-lg shadow mt-2">
                        ã‚²ãƒ¼ãƒ ã«æˆ»ã‚‹
                    </button>
                </div>
            </div>

        </div>
    </div>

    <script>
        // ==========================================
        //  1. åŸºæœ¬ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ (é™çš„ãƒ‡ãƒ¼ã‚¿)
        // ==========================================
        const staticBooksData = [
            // --- è‹±èª ---
            { title: "ãƒãƒ£ãƒ¼ãƒˆå¼ åŸºç¤ã‹ã‚‰ã®æ•°å­¦ï¼ˆé’ãƒãƒ£ãƒ¼ãƒˆï¼‰", comment: "å—é¨“æ•°å­¦ã®ç‹é“ä¸­ã®ç‹é“ã€‚", hints: ["ç§‘ç›®ã¯æ•°å­¦ã ã€‚", "è‰²ã¯é’è‰²ã€‚", "ç¶²ç¾…æ€§ãŒé«˜ã„ã€‚", "æ•°ç ”å‡ºç‰ˆã€‚", "é€šç§°ã€é’ãƒãƒ£ã€ã ã€‚"] },
            { title: "ã‚·ã‚¹ãƒ†ãƒ è‹±å˜èª", comment: "ãƒŸãƒ‹ãƒãƒ«ãƒ•ãƒ¬ãƒ¼ã‚ºãŒé©å‘½çš„ã€‚", hints: ["ç§‘ç›®ã¯è‹±èªã ã€‚", "ãƒŸãƒ‹ãƒãƒ«ãƒ•ãƒ¬ãƒ¼ã‚ºã€‚", "é »å‡ºé †ã€‚", "é§¿å°æ–‡åº«ã€‚", "é€šç§°ã€ã‚·ã‚¹å˜ã€ã ã€‚"] },
            { title: "è‹±å˜èªTarget1900", comment: "çŠ¬ã®ãƒãƒ¼ã‚¯ã§ãŠãªã˜ã¿ã€‚", hints: ["ç§‘ç›®ã¯è‹±èªã ã€‚", "çŠ¬ã®ã‚·ãƒ«ã‚¨ãƒƒãƒˆã€‚", "ä¸€èªä¸€ç¾©ã€‚", "æ—ºæ–‡ç¤¾ã€‚", "ã€1900ã€ã€‚"] },
            { title: "Next Stage", comment: "æ–‡æ³•å•é¡Œé›†ã®ä»£åè©ã€‚", hints: ["ç§‘ç›®ã¯è‹±èªã ã€‚", "è¦‹é–‹ãæ§‹æˆã€‚", "æ–‡æ³•ãƒ»èªæ³•ã€‚", "æ¡åŸæ›¸åº—ã€‚", "é€šç§°ã€ãƒã‚¯ã‚¹ãƒ†ã€ã€‚"] },
            { title: "é‰„å£", comment: "æ±å¤§å¿—æœ›è€…ã®ãƒã‚¤ãƒ–ãƒ«ã€‚", hints: ["ç§‘ç›®ã¯è‹±èªã ã€‚", "éå¸¸ã«åˆ†åšã„ã€‚", "æ±å¤§å°‚é–€å¡¾ã€‚", "è¡¨ç´™ã¯ç™½ã€‚", "é€šç§°ã€é‰„å£ã€ã ã€‚"] },
            // --- æ•°å­¦ ---
            { title: "åŸºç¤å•é¡Œç²¾è¬›", comment: "ç·‘è‰²ã®è¡¨ç´™ã§è–„ã„ã®ãŒç‰¹å¾´ã€‚", hints: ["ç§‘ç›®ã¯æ•°å­¦ã ã€‚", "ç²¾è¬›ã‚·ãƒªãƒ¼ã‚ºã€‚", "å•é¡Œæ•°ãŒå³é¸ã€‚", "ç·‘è‰²ã€‚", "é€šç§°ã€åŸºç¤å•ã€ã€‚"] },
            { title: "Focus Gold", comment: "é’ãƒãƒ£ãƒ¼ãƒˆã®å¼·åŠ›ãªãƒ©ã‚¤ãƒãƒ«ã€‚", hints: ["ç§‘ç›®ã¯æ•°å­¦ã ã€‚", "é»’ã„è¡¨ç´™ã€‚", "é«˜ç´šæ„ŸãŒã‚ã‚‹ã€‚", "å•“æ—é¤¨ã€‚", "é€šç§°ã€ãƒ•ã‚©ã‚«ã‚´ã€ã€‚"] },
            // --- ç‰©ç†/åŒ–å­¦ ---
            { title: "ç‰©ç†ã®ã‚¨ãƒƒã‚»ãƒ³ã‚¹", comment: "ç‰©ç†é¸æŠè€…ã®9å‰²ãŒæŒã£ã¦ã„ã‚‹ã€‚", hints: ["ç§‘ç›®ã¯ç‰©ç†ã ã€‚", "éå¸¸ã«è–„ã„ã€‚", "2å†Šã‚ã‚‹ã€‚", "æµœå³¶æ¸…åˆ©å…ˆç”Ÿã€‚", "ã€è‰¯å•ã®é¢¨ã€ã¸æ¥ç¶šã€‚"] },
            { title: "åŒ–å­¦é‡è¦å•é¡Œé›†", comment: "ç†ç³»å—é¨“ç”Ÿã®ã‚·ã‚§ã‚¢No.1ã€‚", hints: ["ç§‘ç›®ã¯åŒ–å­¦ã ã€‚", "æ•°ç ”å‡ºç‰ˆã€‚", "Aå•é¡Œã¨Bå•é¡Œã€‚", "æ¯å¹´è‰²ãŒå¤‰ã‚ã‚‹ã€‚", "é€šç§°ã€é‡å•ã€ã€‚"] },
            // --- å›½èª/ç¤¾ä¼š ---
            { title: "å¤æ–‡å˜èªã‚´ãƒ­ã‚´", comment: "å¼·çƒˆãªèªå‘‚åˆã‚ã›ã€‚", hints: ["ç§‘ç›®ã¯å¤æ–‡ã ã€‚", "ã‚¤ãƒ©ã‚¹ãƒˆã¨èªå‘‚ã€‚", "æ¿é‡åšè¡Œå…ˆç”Ÿã€‚", "ã‚ãªã‹ã—ã“ã€‚", "ã€ã‚´ãƒ­ã€ãŒå…¥ã‚‹ã€‚"] },
            { title: "å±±å·ã®è©³èª¬ä¸–ç•Œå²", comment: "æ•™ç§‘æ›¸ã ãŒæœ€å¼·ã®å‚è€ƒæ›¸ã€‚", hints: ["ç§‘ç›®ã¯ä¸–ç•Œå²ã ã€‚", "æ•™ç§‘æ›¸ã ã€‚", "å±±å·å‡ºç‰ˆç¤¾ã€‚", "è«–è¿°ã®åŸºç¤ã€‚", "ã‚ªãƒ¬ãƒ³ã‚¸è‰²ã€‚"] }
        ];

        // ==========================================
        //  2. ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ãƒ»çŠ¶æ…‹ç®¡ç†
        // ==========================================
        let allBooks = []; 
        let currentBook = null;
        let shuffledHints = [];
        let hintIndex = 0; // ãƒãƒ¼ãƒãƒ«ãƒ¢ãƒ¼ãƒ‰ç”¨
        let score = 100;
        let currentRank = "";
        let editingIndex = null; 
        let currentGameMode = 'normal'; // 'normal' or 'hard'
        let openedHints = []; // ãƒãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ‰ç”¨ï¼šé–‹å°æ¸ˆã¿ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç®¡ç†

        const maxHints = 10;
        const STORAGE_KEY = 'myQuizBooks_v8'; 

        // DOMè¦ç´ 
        const screens = {
            start: document.getElementById('start-screen'),
            game: document.getElementById('game-screen'),
            result: document.getElementById('result-screen'),
            admin: document.getElementById('admin-screen'),
            login: document.getElementById('login-screen')
        };
        const spiritMessage = document.getElementById('spirit-message');
        const hintsContainer = document.getElementById('hints-container');
        const currentScoreEl = document.getElementById('current-score');
        const answerInput = document.getElementById('answer-input');
        const booksListEl = document.getElementById('books-list');
        const nextHintBtn = document.getElementById('next-hint-btn');
        const selectHintPanel = document.getElementById('select-hint-panel');
        const hintButtonsGrid = document.getElementById('hint-buttons-grid');
        const modeBadge = document.getElementById('mode-badge');
        
        // Admin
        const customCountEl = document.getElementById('custom-count');
        const adminPasswordInput = document.getElementById('admin-password');

        // ==========================================
        //  3. ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ‰ãƒ»åˆæœŸåŒ–å‡¦ç†
        // ==========================================
        function init() {
            let storedBooks = null;
            try { storedBooks = JSON.parse(localStorage.getItem(STORAGE_KEY)); } catch(e) {}
            if (!storedBooks || !Array.isArray(storedBooks) || storedBooks.length === 0) {
                storedBooks = [...staticBooksData];
                saveToStorage(storedBooks);
            }
            allBooks = storedBooks;
            updateDatalist();
            customCountEl.textContent = allBooks.length;
        }

        function saveToStorage(data) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        }

        function updateDatalist() {
            booksListEl.innerHTML = '';
            const sortedBooks = [...allBooks].sort((a, b) => a.title.localeCompare(b.title, 'ja'));
            sortedBooks.forEach(book => {
                const option = document.createElement('option');
                option.value = book.title;
                booksListEl.appendChild(option);
            });
        }

        // ==========================================
        //  4. ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯
        // ==========================================
        function shuffleArray(array) {
            const arr = [...array];
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }

        function prepareHints(book, mode) {
            const allHints = [...book.hints];
            
            // ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°å‡¦ç†ï¼ˆãƒ’ãƒ³ãƒˆãŒ10å€‹æœªæº€ã®å ´åˆï¼‰
            const fillerHints = ["ã¾ã ç„¦ã‚‹æ™‚é–“ã§ã¯ãªã„...", "å¿ƒã‚’è½ã¡ç€ã‘ã¦è€ƒãˆã‚ˆ...", "çŸ¥è­˜ã®æµ·ã«æ½œã‚‹ã®ã ...", "ç­”ãˆã¯å›ã®ä¸­ã«ã‚ã‚‹...", "ã‚‚ã†å°‘ã—ãƒ’ãƒ³ãƒˆãŒæ¬²ã—ã„ã‹ï¼Ÿ"];
            let fillerIndex = 0;
            while(allHints.length < maxHints) {
                allHints.unshift(fillerHints[fillerIndex % fillerHints.length]);
                fillerIndex++;
            }

            if (mode === 'normal') {
                // ãƒãƒ¼ãƒãƒ«: æœ€å¾Œ(æ±ºå®šæ‰“)ã¯å›ºå®šã€ãã‚Œä»¥å¤–ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«
                const lastHint = allHints.pop(); 
                let selectedHints = shuffleArray(allHints).slice(0, maxHints - 1);
                selectedHints.push(lastHint); 
                return selectedHints;
            } else {
                // ãƒãƒ¼ãƒ‰: å®Œå…¨ã‚·ãƒ£ãƒƒãƒ•ãƒ«ï¼ˆæ±ºå®šæ‰“ãŒæœ€åˆã«æ¥ã‚‹å¯èƒ½æ€§ã‚‚ã‚ã‚‹ï¼‰
                return shuffleArray(allHints).slice(0, maxHints);
            }
        }

        function startGame(mode) {
            if(allBooks.length === 0) { alert("å‡ºé¡Œã§ãã‚‹å•é¡ŒãŒã‚ã‚Šã¾ã›ã‚“ï¼"); return; }

            currentGameMode = mode;
            score = 100;
            hintIndex = 0; // ãƒãƒ¼ãƒãƒ«ç”¨
            openedHints = []; // ãƒãƒ¼ãƒ‰ç”¨
            answerInput.value = '';
            hintsContainer.innerHTML = '';
            currentScoreEl.textContent = score;

            // ãƒ¢ãƒ¼ãƒ‰åˆ¥UIè¨­å®š
            if (mode === 'normal') {
                modeBadge.textContent = "NORMAL";
                modeBadge.className = "bg-blue-100 text-blue-600 px-2 py-0.5 rounded text-xs font-bold";
                nextHintBtn.classList.remove('hidden');
                nextHintBtn.disabled = false;
                nextHintBtn.innerHTML = `<span>ğŸ’¡ æ¬¡ã®ãƒ’ãƒ³ãƒˆã‚’è¦‹ã‚‹</span><span class="bg-white px-2 py-0.5 rounded text-xs text-indigo-500">-10ç‚¹</span>`;
                nextHintBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                selectHintPanel.classList.add('hidden');
                updateMessage("æŒ‘æˆ¦è€…ã‚ˆã€ã“ã®æ›¸ç‰©ãŒã‚ã‹ã‚‹ã‹ï¼Ÿ");
            } else {
                modeBadge.textContent = "HARD";
                modeBadge.className = "bg-purple-100 text-purple-600 px-2 py-0.5 rounded text-xs font-bold";
                nextHintBtn.classList.add('hidden');
                selectHintPanel.classList.remove('hidden');
                renderHintButtons();
                updateMessage("é‹å‘½ã®ã‚«ãƒ¼ãƒ‰ã‚’é¸ã¹ã€‚ç›´æ„Ÿã‚’ä¿¡ã˜ã‚‹ã®ã ã€‚");
            }

            currentBook = allBooks[Math.floor(Math.random() * allBooks.length)];
            shuffledHints = prepareHints(currentBook, mode);

            switchScreen('game');

            // ãƒãƒ¼ãƒãƒ«ãƒ¢ãƒ¼ãƒ‰ã®ã¿ã€æœ€åˆã«1ã¤å‡ºã™
            if (mode === 'normal') {
                addHintToDisplay(shuffledHints[0], 1);
            }
        }

        // --- ãƒãƒ¼ãƒãƒ«ãƒ¢ãƒ¼ãƒ‰ç”¨ ---
        function showNextHint() {
            if (hintIndex >= maxHints - 1) return;
            hintIndex++;
            score -= 10;
            currentScoreEl.textContent = score;
            addHintToDisplay(shuffledHints[hintIndex], hintIndex + 1);

            const messages = ["", "ãµã‚€ã€ã¾ã ã‹ã€‚", "ç„¦ã‚‹ã§ãªã„ã€‚", "å°‘ã—ãšã¤è¦‹ãˆã¦ããŸã‹ï¼Ÿ", "ã“ã‚Œãªã‚‰ã©ã†ã ï¼Ÿ", "æŠ˜ã‚Šè¿”ã—åœ°ç‚¹ã ãã€‚", "ã‹ãªã‚Šçµã‚‰ã‚Œã¦ããŸã¯ãšã ã€‚", "æ ¸å¿ƒã«è¿«ã£ã¦ã„ã‚‹ãã€‚", "ã‚ã¨å°‘ã—ã ...", "æœ€å¾Œã®ãƒ’ãƒ³ãƒˆã ï¼"];
            const msgIndex = Math.min(hintIndex, messages.length - 1);
            updateMessage(messages[msgIndex]);

            if (hintIndex === maxHints - 1) {
                nextHintBtn.disabled = true;
                nextHintBtn.textContent = "å…¨ã¦ã®ãƒ’ãƒ³ãƒˆãŒå‡ºã¾ã—ãŸ";
                nextHintBtn.classList.add('opacity-50', 'cursor-not-allowed');
            }
        }

        // --- ãƒãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ‰ç”¨ ---
        function renderHintButtons() {
            hintButtonsGrid.innerHTML = '';
            for (let i = 0; i < maxHints; i++) {
                const btn = document.createElement('button');
                btn.className = "h-12 bg-purple-100 hover:bg-purple-200 text-purple-800 rounded font-bold transition shadow-sm border border-purple-200";
                btn.textContent = "?";
                btn.onclick = () => revealSpecificHint(i, btn);
                hintButtonsGrid.appendChild(btn);
            }
        }

        function revealSpecificHint(index, btnElement) {
            if (openedHints.includes(index)) return;
            
            openedHints.push(index);
            score -= 15; // ãƒãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ‰ã¯ã‚³ã‚¹ãƒˆãŒé«˜ã„
            currentScoreEl.textContent = score;
            
            // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
            btnElement.disabled = true;
            btnElement.className = "h-12 bg-gray-100 text-gray-400 rounded font-bold border border-gray-200 cursor-default";
            btnElement.textContent = index + 1;

            // ãƒ’ãƒ³ãƒˆè¡¨ç¤º
            addHintToDisplay(shuffledHints[index], openedHints.length); // ç•ªå·ã¯é–‹ã‘ãŸé †
            
            // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            const hardMessages = ["ã»ã†ã€ãã“ã‚’é–‹ã‘ã‚‹ã‹ã€‚", "é‹å‘½ã®æ‚ªæˆ¯ã‹ã€å¿…ç„¶ã‹ã€‚", "å½¹ã«ç«‹ã¤æƒ…å ±ã‹ãªï¼Ÿ", "ã‚‚ã£ã¨ã‚ãã‚‹ãŒè‰¯ã„ã€‚", "ç‚¹æ•°ãŒæ¸›ã£ã¦ã„ãã..."];
            updateMessage(hardMessages[Math.floor(Math.random() * hardMessages.length)]);
        }

        function addHintToDisplay(text, num) {
            const div = document.createElement('div');
            const isFiller = text.includes("...");
            const bgColor = isFiller ? "bg-gray-50" : "bg-white";
            const textColor = isFiller ? "text-gray-500" : "text-gray-700";
            const borderColor = currentGameMode === 'normal' ? (isFiller ? "border-gray-300" : "border-indigo-400") : "border-purple-400";
            const labelColor = currentGameMode === 'normal' ? "text-indigo-600" : "text-purple-600";
            
            div.className = `fade-in ${bgColor} border-l-4 ${borderColor} p-3 rounded text-sm ${textColor} shadow-sm flex flex-col`;
            const labelText = isFiller ? "MESSAGE" : `HINT ${num}`;
            div.innerHTML = `<span class="font-bold ${labelColor} text-xs mb-1">${labelText}</span><span class="text-base">${text}</span>`;
            hintsContainer.appendChild(div);
            hintsContainer.scrollTop = hintsContainer.scrollHeight;
        }

        function checkAnswer() {
            const userAnswer = answerInput.value.trim();
            if (!userAnswer) {
                updateMessage("ç­”ãˆã‚’å…¥åŠ›ã™ã‚‹ã®ã ï¼");
                answerInput.focus();
                return;
            }
            if (userAnswer === currentBook.title) {
                endGame(true);
            } else {
                updateMessage(`ã€Œ${userAnswer}ã€ã§ã¯ãªã„...å†è€ƒã›ã‚ˆã€‚`);
                answerInput.classList.add('bg-red-50', 'border-red-300');
                setTimeout(() => answerInput.classList.remove('bg-red-50', 'border-red-300'), 1000);
            }
        }

        function giveUp() {
            if(confirm("æœ¬å½“ã«è«¦ã‚ã‚‹ã®ã‹ï¼Ÿ")) {
                score = 0;
                endGame(false);
            }
        }

        function endGame(isWin) {
            switchScreen('result');
            const resultTitle = document.getElementById('result-title');
            const resultIcon = document.getElementById('result-icon');
            const resultBookName = document.getElementById('result-book-name');
            const finalScoreEl = document.getElementById('final-score');
            const resultRank = document.getElementById('result-rank');
            const resultComment = document.getElementById('result-comment');

            resultBookName.textContent = currentBook.title;
            finalScoreEl.textContent = score;
            resultComment.textContent = currentBook.comment || "ç´ æ™´ã‚‰ã—ã„ä¸€å†Šã ã€‚";

            if (isWin) {
                resultIcon.textContent = "ğŸ‰";
                resultTitle.textContent = "æ­£è§£ï¼";
                resultTitle.className = currentGameMode === 'normal' ? "text-2xl font-bold text-indigo-600" : "text-2xl font-bold text-purple-600";
                
                // ãƒ©ãƒ³ã‚¯è¨ˆç®—ï¼ˆãƒ¢ãƒ¼ãƒ‰ã«ã‚ˆã‚‹é•ã„ã¯ãªã—ã€ç‚¹æ•°å‹è² ï¼‰
                if (score === 100) { currentRank = "SS (ç¥)"; resultRank.className = "text-xl font-bold text-yellow-500"; }
                else if (score >= 80) { currentRank = "S (å„ªç§€)"; resultRank.className = "text-xl font-bold text-orange-500"; }
                else if (score >= 40) { currentRank = "A (åˆæ ¼)"; resultRank.className = "text-xl font-bold text-green-500"; }
                else { currentRank = "B (ä¿®è¡Œ)"; resultRank.className = "text-xl font-bold text-gray-500"; }
                resultRank.textContent = currentRank;
                updateMessage("è¦‹äº‹ã ï¼æ¬¡ã‚‚ãã®èª¿å­ã§é ¼ã‚€ãã€‚");
            } else {
                resultIcon.textContent = "ğŸ³ï¸";
                resultTitle.textContent = "æ®‹å¿µ...";
                resultTitle.className = "text-2xl font-bold text-gray-500";
                currentRank = "-";
                resultRank.textContent = currentRank;
                updateMessage("çŸ¥è­˜ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒå¿…è¦ã ãªã€‚");
            }
        }

        function createShareText() {
            const title = currentBook.title;
            const modeText = currentGameMode === 'normal' ? "ãƒãƒ¼ãƒãƒ«" : "ãƒãƒ¼ãƒ‰";
            const resultText = score > 0 ? `${score}ç‚¹ï¼ˆãƒ©ãƒ³ã‚¯${currentRank}ï¼‰` : "é™å‚ã—ã¾ã—ãŸ...";
            return `ã€å‚è€ƒæ›¸ãƒã‚¤ã‚¹ã‚¿ãƒ¼ã®æŒ‘æˆ¦çŠ¶ã€‘\n[${modeText}ãƒ¢ãƒ¼ãƒ‰]ã§ã€Œ${title}ã€ã‚’å½“ã¦ã¾ã—ãŸï¼\nçµæœï¼š${resultText}\n\n#å‚è€ƒæ›¸ã‚¯ã‚¤ã‚º #å—é¨“å‹‰å¼·\n`;
        }

        function shareOnTwitter() {
            const text = createShareText();
            const url = "https://twitter.com/intent/tweet?text=" + encodeURIComponent(text);
            window.open(url, '_blank');
        }

        function shareOnLine() {
            const text = createShareText();
            const url = "https://line.me/R/msg/text/?" + encodeURIComponent(text);
            window.open(url, '_blank');
        }

        // ==========================================
        //  5. ãƒ­ã‚°ã‚¤ãƒ³ãƒ»ç®¡ç†æ©Ÿèƒ½
        // ==========================================
        function resetGame() {
            backToStart();
        }

        function backToStart() {
            switchScreen('start');
            updateMessage("ã•ã‚ã€ç§ã®çŸ¥è­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«æŒ‘ã‚€ãŒè‰¯ã„ã€‚");
        }

        function goToLogin() {
            switchScreen('login');
            updateMessage("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã›ã‚ˆã€‚");
            adminPasswordInput.value = ''; 
        }

        function attemptLogin() {
            const pw = adminPasswordInput.value;
            if (pw === 'admin') {
                toggleAdminMode();
            } else {
                alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™ï¼\n(ãƒ’ãƒ³ãƒˆ: admin)");
                adminPasswordInput.value = '';
                adminPasswordInput.focus();
            }
        }

        function logoutAdmin() {
            if(confirm("ç®¡ç†ç”»é¢ã‹ã‚‰ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ")) backToStart();
        }

        function toggleAdminMode() {
            switchScreen('admin');
            updateMessage("ç®¡ç†è€…æ¨©é™ã§ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’æ“ä½œä¸­...");
            renderBooksList();
            cancelEdit(); 
        }

        function renderBooksList() {
            const listContainer = document.getElementById('books-list-container');
            listContainer.innerHTML = '';
            if (allBooks.length === 0) {
                listContainer.innerHTML = '<p class="text-xs text-gray-400 py-2">ç™»éŒ²ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
                return;
            }
            allBooks.forEach((book, index) => {
                const div = document.createElement('div');
                div.className = "bg-white p-2 rounded border border-gray-100 flex justify-between items-center text-sm shadow-sm";
                if (index === editingIndex) div.className += " border-indigo-400 bg-indigo-50";
                div.innerHTML = `
                    <div class="truncate flex-1 mr-2"><span class="font-bold text-gray-700">${book.title}</span></div>
                    <div class="flex gap-1 flex-shrink-0">
                        <button onclick="editBook(${index})" class="bg-blue-100 text-blue-600 px-2 py-1 rounded text-xs hover:bg-blue-200 font-bold transition">ç·¨é›†</button>
                        <button onclick="deleteBook(${index})" class="bg-red-100 text-red-600 px-2 py-1 rounded text-xs hover:bg-red-200 font-bold transition">å‰Šé™¤</button>
                    </div>
                `;
                listContainer.appendChild(div);
            });
            customCountEl.textContent = allBooks.length;
        }

        function editBook(index) {
            const book = allBooks[index];
            if(!book) return;
            editingIndex = index;
            document.getElementById('form-title').textContent = "å‚è€ƒæ›¸ã‚’ç·¨é›†";
            document.getElementById('form-title').className = "font-bold text-sm text-blue-600";
            document.getElementById('save-btn').textContent = "æ›´æ–°ã—ã¦ä¿å­˜";
            document.getElementById('save-btn').className = "w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 rounded shadow text-sm";
            document.getElementById('cancel-edit-btn').classList.remove('hidden');

            document.getElementById('new-title').value = book.title;
            document.getElementById('new-comment').value = book.comment || "";
            for(let i=1; i<=10; i++) document.getElementById(`new-hint-${i}`).value = '';
            if(book.hints && Array.isArray(book.hints)) {
                book.hints.forEach((hint, i) => { if(i < 10) document.getElementById(`new-hint-${i+1}`).value = hint; });
            }
            renderBooksList();
        }

        function cancelEdit() {
            editingIndex = null;
            clearForm();
            document.getElementById('form-title').textContent = "æ–°è¦å‚è€ƒæ›¸ã‚’è¿½åŠ ";
            document.getElementById('form-title').className = "font-bold text-sm text-indigo-600";
            document.getElementById('save-btn').textContent = "ãƒªã‚¹ãƒˆã«è¿½åŠ ã—ã¦ä¿å­˜";
            document.getElementById('save-btn').className = "w-full bg-green-500 hover:bg-green-600 text-white font-bold py-2 rounded shadow text-sm";
            document.getElementById('cancel-edit-btn').classList.add('hidden');
            renderBooksList();
        }

        function clearForm() {
            document.getElementById('new-title').value = '';
            document.getElementById('new-comment').value = '';
            for(let i=1; i<=10; i++) document.getElementById(`new-hint-${i}`).value = '';
        }

        function handleSaveBook() {
            const title = document.getElementById('new-title').value.trim();
            const comment = document.getElementById('new-comment').value.trim();
            const hints = [];
            for(let i=1; i<=10; i++) {
                const h = document.getElementById(`new-hint-${i}`).value.trim();
                if(h) hints.push(h);
            }
            if (!title || hints.length === 0) {
                alert("ã€Œæ›¸ç±åã€ã¨ã€Œå°‘ãªãã¨ã‚‚1ã¤ã®ãƒ’ãƒ³ãƒˆã€ã¯å¿…é ˆã§ã™ï¼");
                return;
            }
            const bookData = { title, comment, hints };
            if (editingIndex !== null) {
                allBooks[editingIndex] = bookData;
                alert(`ã€Œ${title}ã€ã‚’æ›´æ–°ã—ã¾ã—ãŸï¼`);
            } else {
                allBooks.push(bookData);
                alert(`ã€Œ${title}ã€ã‚’è¿½åŠ ã—ã¾ã—ãŸï¼`);
            }
            saveToStorage(allBooks);
            cancelEdit(); 
            init(); 
        }

        function deleteBook(index) {
            if(!confirm("æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nï¼ˆã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ï¼‰")) return;
            allBooks.splice(index, 1);
            saveToStorage(allBooks);
            if(editingIndex === index) cancelEdit();
            else if (editingIndex !== null && editingIndex > index) editingIndex--;
            renderBooksList();
            init();
        }

        function resetToDefault() {
            if(!confirm("ã€è­¦å‘Šã€‘\nã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã€åˆæœŸçŠ¶æ…‹ã«æˆ»ã—ã¾ã™ã€‚\næœ¬å½“ã«ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ")) return;
            localStorage.removeItem(STORAGE_KEY);
            alert("ãƒ‡ãƒ¼ã‚¿ã‚’åˆæœŸåŒ–ã—ã¾ã—ãŸã€‚");
            init(); 
            renderBooksList();
        }

        function exportData() {
            if(allBooks.length === 0) { alert("ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚"); return; }
            const jsonStr = JSON.stringify(allBooks, null, 2);
            navigator.clipboard.writeText(jsonStr).then(() => { alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼"); });
        }

        function switchScreen(screenName) {
            Object.values(screens).forEach(el => el.classList.add('hidden'));
            screens[screenName].classList.remove('hidden');
        }

        function updateMessage(text) {
            spiritMessage.textContent = text;
        }

        init();
    </script>
</body>
</html>